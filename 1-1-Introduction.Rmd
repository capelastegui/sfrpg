# Introduction

```{r, echo=FALSE, results='asis', message=FALSE, warning=FALSE, prompt=FALSE}
basedir <- here::here()
library(png)
library(grid)
library(sfrpg)
library(magrittr)
```

## Welcome to the game

Welcome to Square Fireballs! In this game, a group of friends can take the role
 of a party of adventurers exploring a fantasy world, fighting rampaging
 monsters, and discovering ancient treasures. 

We recommend playing this game in groups of 4 to 6 players. 

### What is a Role Playing Game?

Square Fireballs is a Role Playing Game, that is, a game where players use their
 imagination to represent characters in a simulated world. Players sit on a
 table, and use rulebooks, pen, paper and dice to resolve character actions and
 keep track of game progress.

There are two types of players in these games:

- **Player Characters**: Each Player Character (abreviated as **PC**) has a
  character with their own unique background, personality, and set of skills.
  Player Characters get to decide what actions their characters take, but not
  necessarily the outcomes of these actions - those are determined by the
  rules of the game and usually involve a random element like rolling dice.
- **Game Master**: The Game Master, or **GM**, is in control of the game world:
  its environments and history, and all characters other than the Player
  Characters (which are known as **Non-Player Characters**, or **NPCs**).
  The Game Master's responsibility is to present interesting scenarios and
  challenges for the players to overcome. In each game session there must be
  one Game Master.

A Role Playing Game is composed of a set of **game rules**, which provide a
 framework to resolve the character's actions and their interactions with each
 other and with the game world. Another component that is often present is a
 description of the **game setting**: the people and places that PCs can
 interact with. This is used as a reference by GM and PCs alike to better
 understand what is going on in the game, and how their characters should
 behave. In addition, many games also include suggestions on how to run a game,
 explanations of the game philosophy, and other pieces of advice. 

Role Playing games are usually played in **game sessions** of a few hours of
 duration. Player groups that meet regularly can have a persistent continuity
 across game sessions, following the adventures of a cast of recurring
 characters over extended periods of time - this is known as a
 **game campaign**.

Unlike board games and most computer games, Role Playing Games do not have a
 fixed set of goals or win conditions. Rather, a GM presents Player Characters
 with a series of scenarios, often involving but not limited to the resolution
 of missions and quests. The Player Characters are not obligated to achieve
 these missions, but are encouraged to do in order to aquire wealth and fame
 within the game world (or, more rarely, out of sheer nobility and heroism).
 On the other hand, it is quite possible for characters to die in the game,
 and a party of PCs can, in fact, lose the game when all their characters are
 dead. 

It should be noted, though, that although the GM is in control of the PCs'
 enemies, a GM's goal in the game is not to defeat the PCs, but to present
 them with challenging encounters, to enforce the game rules with fairness,
 and to make the game as fun as possible for everyone. The risk of beloved
 characters suffering, or even dying, is just a valuable tool to achieve an
 engaging and memorable game experience.


### Why Square Fireballs?

Why did we choose to call our game Square Fireballs? What does that even mean?
 The following figures illustrate the reasoning behind the name:
 
```{r, echo=FALSE, results='asis', message=FALSE, warning=FALSE, prompt=FALSE}
img1 <- readPNG(file.path(basedir,"figures","Square-Fireball-1.png"))
img2 <- readPNG(file.path(basedir,"figures","Square-Fireball-2.png"))
grid.raster(img1,interpolate=FALSE,x=0.25,width=unit(0.4, "npc"))
grid.raster(img2,interpolate=FALSE,x=0.75,width=unit(0.4, "npc"))
#grid.raster(img1,width=0.5,height=0.5,  )
#grid.raster(img2,width=2,height=0.5)
```

In this game, whenever a combat encounter comes up, characters are arranged on
 a gridded map in order to keep track of their relative positions. This can be
 done by using miniatures to represent each character, or other means such as
 cardboard tokens. The grid map is composed of **squares** - each square being
 the minimum unit of distance in the game. Typically, each character fits in a
 single square, though other character sizes are also allowed. Each character
 can move a certain number of squares during a game turn, and make melee attacks
 to enemy characters in adjacent squares. A character's ranged attacks have a
 maximum range measured in squares. Diagonal movement across squares in the map
 is handled just the same as horizontal or vertical movement - just count the
 number of squares crossed -  which introduces some interesting distortions to
 the map geometry. And this brings us back to the figures above, and the Square
 Fireballs.

You see, this is a game set in a fantasy world where heroic adventurers such as
 fighters, rogues and wizards battle hordes of monsters like orcs and goblins.
 The figure to the left depicts a **wizard** (leftmost square) facing four
 **goblins** and an **orc** (to the right). Now, wizard characters are famous
 for their ability to conjure offensive spells to blast groups of enemies. The
 right figure shows one such spell, a **Lesser Fireball**, centered on the
 unfortunate orc, and producing an explosion that damages everything in adjacent
 squares - including the orc's four goblin buddies. Observant readers will note
 that, due to the geometrical liberties we have taken in our choice of map
 representation, the aforementioned ball of fire is rendered as a perfect
 square. The author's questionable sense of humor found this fact funny enough
 to use as the name for a blog and, years later, as the title of a game. 

And this is why you will soon be playing a game called Square Fireballs, and
 why goblins don't like to walk close to each other.

### Why should you play this game?

In the decades since the invention of role playing games, there have been
 plenty of game systems based on the same basic concept of adventuring in a
 fantasy world. Many of them are great. Some introduce highly innovative
 ideas in their rules or settings. Most of them are prettier than the one
 you hold in your hands. Why, then, should you keep reading this particular
 book and spend your valuable time learning a fairly complex set of rules? 

The defining features of Square Fireballs are rich tactical combat, flexible
 and straightforward rules for non-combat interactions, and easy preparation
 of game sessions and characters. Of these, I believe that the star of the
 show is the combat. It is a deep system that rewards careful positioning,
 teamwork, and resource management. It offers a great deal of variety, in
 options for building and playing characters, as well as in the range of
 available monsters, and in the ways of interacting with the environment.
 And yet, I have taken great efforts to make the rules as accessible and
 consistent as possible, while removing any complexity above the strictly
 necessary.

The rules for handling challenges outside of combat are a different beast
 altogether. All interactions share the same simple resolution mechanic, and
 there are always multiple paths to achieve an objective. Creative thinking,
 planning and collaboration are rewarded, and there are clear guidelines for
 handling failures and allowing the game to move forward. 

Finally, the game goes to great lengths to reduce the effort and difficulty of
 setting up a session. Characters are highly customizable, but players are
 always offered a default option, and all choices are close enough in
 effectiveness that even choosing at random should result in a competent
 and enjoyable adventurer. Monsters are likewise easy to customize, and random
 generation of monsters and encounters is both supported and encouraged.
 Characters have levels that determine their overall power, but the progression
 is smooth enough that adventurers and monsters of a wide range of levels can
 take part in the same session in a satisfying way.

It's only fair to mention that Square Fireballs is not a perfect system, nor
 is it a game for everybody. There is a strong emphasis in combat, and while
 I believe that the non-combat mechanics are solid enough, players that are not
 interested in fighting monsters will be missing a huge part of the system. The
 design prioritizes gameplay over realism, and players that look for accurate
 simulations of fantastical societies and ecosystems will probably not find
 what they are looking for in here. And the game lacks an actual setting,
 and leaves Game Masters to borrow their world descriptions from other sources
 - though, on the bright side, it has been designed to be quite flexible in
 that regard, and be able to fit in anything from high fantasy to nonmagical
 medieval adventure.

All of these disclaimers aside, I honestly believe there is a great time to be
 had in here. If you are at all excited by the notion of incinerating goblins,
 pushing ogres off cliffs, triggering trapped chests, grappling with dragons,
 finding legendary swords, talking to mysterious strangers in taverns, arguing
 with kings, leaping from the shadows, performing miracles, getting stabbed,
 bitten, cursed, imprisoned, poisoned, petrified or swallowed whole... this
 may be the game for you.

## A note on text format

We use different styles of text to differentiate between game rules and
 definitions, and other types of content. Here is a quick summary:

Normally formatted, black text is used to describe game rules.

<em>Italics are used to provide non-mechanic related descriptions: flavor,
 backstory.</em>

```
Text in white boxes is used to define formulas.
```

<div class="tip">Blue text is used to provide advice on how to play the game.
 It is typically preceded by **“Tip”** or **“Example”**.</div>

<div class="compatibility">Gold text is used to provide compatibility
 instructions to integrate material from legacy sourcebooks. It is typically
 preceded by **“Compatibility Note”**.</div>

<div class="design">Red text is used to provide insight into the designer's
 ideas regarding a game element. It is typically preceded by 
 **"Designer's Note"**.</div>

## Rolling Dice

For any non-trivial action that a character performs in the game, success is
 not guaranteed. We use dice to determine the outcomes of these actions. There
 are three main types of dice rolls in the game:

- **Checks**: Used to determine whether an action is a success or a failure.
- **Damage Rolls**: Used to determine the amount of damage (or, more rarely,
  of healing) that a character takes.
- **Action Point Checks**: Used to determine if a character can use an Action
  Point.

Square Fireballs, like many role playing games, uses special dice with different
 number of sides:

- Twenty-sided dice, or d20
- Four-sided dice, or d4
- Six-sided dice, or d6
- Eight-sided dice, or d8
- Ten-sided dice, or d10
- Twelve-sided dice, or d12

D20s are always used for Checks. D4s are used for Action Point Rolls. Damage
 rolls can use d4s, d6s, d8s, d10s or d12s - the specific dice used by a
 character at any given type depends on that character's choice of weapons
 and powers.

Sometimes the game requires a player to roll severall dice at once as part of a
 damage roll. In these cases, the number of dice is written before the type of
 dice. This way, 2d6 means rolling two six-sided dice, whereas 5d10 means
 rolling five ten-sided dice, and 9d4 means rolling nine four-sided dice. When
 a single die is rolled, no number is required: d12 means rolling one
 twelve-sided die.

The type of dice required for a damage roll in an attack made with a weapon can
 vary depending on the weapon used. Longswords use d8s, whereas Greatswords
 use d12s, daggers use d4s, and so forth. In the game, we use 'W' to refer to
 the damage dice of a weapon attack: W means one die, 2W means two dice, 3W
 means three dice, and so on. When making an attack with a weapon, replace the
 W with the appropriate type of dice used by that weapon: A 'W' attack with a
 Longsword rolls d8, a '2W' attack with a Greatsword rolls 2d12, and a '7W'
 attack with a dagger rolls 7d4.


### Rolling Checks

There are several types of checks in the game that a character can make:

- **Attack Rolls**: Used to determine whether an attack hits or misses. Rolled
  as part of an **Attack Action**.
- **Skill Checks**: Used to determine whether an interaction with other
  characters or the environment is a success or a failure. Rolled as part of a
  Skill Action.
- **Saves**: Used to resist a harmful condition. Some effects allow characters
  to automatically attempt a Save at the end of their turns. These are known as
  'Save Ends' effects. In addition, some powers allow a character to Save
  against certain effects.

The general method to resolve a check is to roll a **d20**, add the character's
 **bonus** to that check (if any) and any **modifiers** that apply, and compare
 the result with a target number. If the result is equal or greater than the
 target number, the check is a success, otherwise, the check is a failure.

- For **Attack Rolls**, the attacking character rolls a **d20**, adds the
  character's **Hit bonus** for that attack and any **attack modifiers**
  that apply, and compares the result with the defending character's 
  **Defense** attribute that is appropriate for that attack. There are four
  different defense attributes: **Armor (Ar), Fortitude (For), Reflex (Ref)
  and Will (Wil)**. This process is described in more detail in the Combat
  chapter.
- For **Skill Check**, the character making the check rolls a **d20**, adds
  the character's **Skill bonus** for the Skill used in that action, and any
  **skill modifiers** that apply. The result is compared with a number based
  on the Skill Check Difficulty. This process is described in more detail in
  the Skills chapter.
- For a **Save**, the character making the save rolls a **d20**, and adds
  any modifiers that apply. If the result is equal to or greater than **11**,
  the Save succeeds, otherwise it is a failure. This process is described in
  more detail in the Combat chapter.

### Damage Rolls

The process of rolling damage varies depending on whether the damage was caused
by a PC or a monster, as described in the following sections.

After rolling damage, modify the damage by any resistances or vulnerabilities that
apply, as described below.

#### Rolling Damage Rolls - PCs

Damage rolls use different rules depending on whether they are made by a PC or 
a monster. We explain the rules for PC damage rolls here, and monster damage
rolls in the next section.

Unlike check rolls, damage rolls do not use a single d20. Instead, a variable
 number and type of dice is used for each damage roll, depending on the damaging
 attack and the weapon used.

To resolve a damage roll, roll all the **Damage Dice** required for the attack,
 and add them together. Then, add to that total the  **Ability Bonus** to damage
 for that attacks well as any other **Damage Bonuses** that apply. High level
 characters then apply multipliers to the damage dice and ability bonus based
 on their level:
```
Damage = (Damage Dice X Dice Multiplier) + Ability Damage Modifier + Damage Bonuses
Ability Damage Modifier = Ability Bonus * Ability Multiplier
```
The level progression for the Dice Multiplier and the Ability Multiplier are
 shown below for convenience. A more detailed description of these stats is
 provided on [later sections](#abilitymult) of this chapter

<div class="very-narrow">
Level  | Dice Multiplier
-- | -----
1   | x1
6	| x1 + Fraction Bonus
16	| x2
21	| x2 + Fraction Bonus
26 	| x3
28 	| x3 + Fraction Bonus
30 	| x4
</div>

<div class="very-narrow">
Level  | Ability Multiplier
--- | -----
1   | x1
4	| x1.5
9	| x2
11 	| x2.5
14	| x3
17 	| x3.5
19	| x4
21 	| x5
24	| x6
27 	| x7
29	| x8
</div>

**Note - Fraction Bonus ** : On some levels, the Dice Multiplier should have
fractional values (e.g. x1.5 at Level 6) in order to reach the expected values.
Since we don't want players making excessively complex operations in the middle
of the game, we instead add a fixed value that approximates the required number.
This value is called Fraction Bonus, and varies with the type of dice rolled,
as shown in the table below:

Die type  | Fraction Bonus
-- | --
d4 | +1
d6 | +1
d8 | +2
d10 | +2
d12 | +3

The Fraction Bonus is added to the value of each die, after applying any
 multiplier. 
 
 <div class="tip">**Example - Dice Multiplier**: Gimli makes an attack 
 with a damage dice of 1d8, and rolls a 5. If Gimli is level 16, the total
 damage for that die will be 5x2=10. If Gimli is level 21, a Fraction Bonus
 would apply, so total damage would be 5x2 + 2 = 12.
 
 If Gimli uses a different attack with damage dice of 2d8, and rolls a 5 and a
  7 (total of 12 before modifiers) , at Level 21 the total damage would be 
  12*2 + 2*2 = 28. 
  
 If you write down the damage for each power on your character sheet, we 
 recommend to include any multipliers and damage bonuses that apply. A 2d8 
 damage power at Level 21 could be written down as:
 
 ```
 2d8 (x2) + 4
 ```
 , meaning that you would need to roll 2d8, multiply the result by 2, and add 4
 to the total due to the Fraction Bonus.
</div>

<div class="tip">**Optional Rule** If you prefer it, and with the GM's approval,
 you can multiply the number of dice rolled instead of the final values. We 
 don't recommend this because rolling too many dice can be unwieldy and time 
 consuming, but some players find it fun.
</div>

<div class="tip">**Tip**: Character HP and damage doubles every 10 levels, so 
a level 30 character will have HP and damage values 8 times as high as those 
of a level 1 character. 
</div>

<div class="design">**Designer's Note** : The reason for different multipliers
for damage dice and ability bonuses is the fact that damage dice for powers
also increase with level. Damage dice for a Level 30 power are double those of
a Level 1 power, so we need a damage dice multiplier of x4 at that level in
order to match the expected total multiplier of x8.</div>

#### Rolling Damage Rolls - Monsters

Monsters have fixed damage values rather than damage dice, so the rules for
their damage rolls are much simpler. When a monster hits an enemy with an attack,
the GM may choose one of the following ways to determine the amount of damage:

- Fixed damage: Deal the amount of attack damage indicated in the monster's stat block.
- Variable damage: Roll 1d6 to modify the base attack damage.

When using variable damage, roll 1d6 and calculate total damage based on the roll:

- 1-2: Base damage - (E)
- 3-4: Base damage
- 5-6: Base damage + (E)

, where (E) is the monster's extra damage stat, as listed in the monster stat block.


<div class="tip">**Example:** A goblin hits a PC with an attack that deals 8 damage.
If the GM chooses to use fixed damage, the attack deals 8 damage. If they choose
variable damage instead, they will roll 1d6 and use the goblin's (E) stat value of 2
to modify the damage, for a total of 6 damage on a roll of 1-2, 8 damage on a roll
of 3-4, and 10 damage on a roll of 5-6.</div>

<div class="tip">**Tip:** We recommend GMs to use fixed damage for minion monsters,
and variable damage for other monsters, to make combat less predictable. That said,
GMs can choose fixed damage for all monsters when they want to speed up combat.</div>

#### Resistances and Vulnerabilities

TODO: Complete this section

Summary - Resistances and vulnerabilities:

- Immunity: Negate damage
- Resistance: Reduce damage by 1/2
- Partial Resistance: Reduce damage by 1/4
- Partial Vulnerability: Increase damage by 1/4
- Vulnerability: Increase damage by 1/2

Notes:

- All fractions are rounded down.
- Resistances can be downgraded as follows: Immunity to Resistance, Resistance to Partial Resistance, Partial Resistance to normal damage
- Vulnerabilities can be downgraded as follows: Vulnerability to Partial Vulnerability, Partial Vulnerability to normal damage
- If there are multiple resistances and vulnerabilities, pick the highest Resistance/Immunity, and the highest Vulnerability. Subtract damage from the Resistance, then add damage from the Vulnerability.

TODO:
- Show examples
- Explain that Immunity + Vulnerability first subtracts 100% damage, then adds the amount from the Vulnerability.


#### Damage Types

An attack can have one or more damage types. There are the following damage types in the game:

- Physical (default)
- Fire
- Cold
- Lightning
- Radiant
- Shadow
- Poison
- Psychic

Damage types do not have any inherent effect, but there are many character abilities that depend on damage type, such as resistances, vulnerabilities, and damage bonuses. If no damage type is specified, the damage type is Physical.

<div class="compatibility">**Compatibility Note**:
Some damage types from legacy rules are no longer supported or have been renamed:

- Necrotic: Renamed to Shadow
- Force: Use Physical instead
- Thunder: Use Physical instead
- Acid: Use Physical instead.

Any legacy rules that grant resistance or vulnerability to Force, Thunder or Acid should be ignored (do not convert them into resistance/vulnerability to Physical). Powers that used to have discontinued damage types can have keywords instead: A character can have powers with the Acid keyword, and Feats or Features that affect these powers.</div>

<div class="tip">**Tip**: These are the resistances (R) and vulnerabilities (V) to damage types of most common monster types:

- Poison - R: Construct, Undead, Dwarf; V: Fey, Plant, Swarm
- Radiant - R: Aberrant, Celestial, Blind; V:Undead, Shadow
- Psychic - R: Construct, Plant, Eladrin; V: Aberrant
- Shadow - R: Shadow; V: Celestial
- Fire - R: Fire, Devil, Tiefling; V: Plant, Cold
- Cold - R: Cold, V: Fire, Ooze
- Lightning - R: Earth, V: Construct
</div>


### Rolling Action Point Checks

**Action Points** are a special kind of resource that Player Characters can
 spend to gain additional actions in combat. Typically, Action Points are not
 available at the start of an encounter but, as the combat progresses, Player
 Characters gain  a small chance of using an Action Point, which increases with
 each additional turn. This is resolved with an **Action Point Check**.

To make an Action Point Check, a character rolls a d6, and adds the current
 value of the **Escalation Die** (explained in the following section), as well
 as any bonuses or penalties to Action Point rolls that apply for that
 character. If the result is 6 or higher, the attempt is successful, and the
 character can spend the Action Point. Otherwise, it is a failure - the
 character is not able to use the Action Point, and no Action Point is lost. 

```
Action Point Check= d6 + Escalation Die + Action Point Check Modifiers
```

The following Action Point Check Modifiers can apply:

- Character is Bloodied: +1

In addition, some characters can have special abilities that modify Action Point
Checks. As an example, Human characters have an Origin Feature that grants them
+1 to Action Point Checks

Each character may only attempt an Action Point Check per turn, and spend a 
single Action Point per encounter.

The primary way to spend an action point is the Use Action Point maneuver:

```{r, echo=FALSE, results='asis', message=FALSE, warning=FALSE, prompt=FALSE}
get_df_power_from_sheet('mnv_actio') %>% clean_df_power() %$%
   htm_power %>% cat()
```

Note that, in addition to Player Characters, some special monsters such as
 Elite or Solo monsters are also capable of using Action Points.

### Escalation Die
 
For each encounter, the GM keeps track of how many rounds have passed
since the encounter started. At the start of the third round, the GM
takes a special d4 called the Escalation Die and sets it to 1. This value
increases on each turn thereafter, as shown in the table below:

Turn | Escalation Die
-- | ---
1 | 0
2 | 0
3 | 1
4 | 2
5 | 3
6+ | 4

The Escalation Die value is used as follows:
- **Add** the Escalation Die to every Hit Roll (both for PCs and monsters)
- **Subtract** the Escalation Die from every Skill Check

<div class="tip">**Tip**: The purpose of the Escalation Die is to ensure that 
 combat encounters do not last too long (by making attacks more lethal
 as time progresses), and to give PCs a sense of urgency on skill encounters
 (by making checks harder with time).</div>

## Character Stats
In this section, we describe the main stats that affect the performance of
 characters (including both Player Characters and Monsters) in the game.

### Level

The **Level** of a character is a general measure of that character's relative
 power. Player Characters start at level 1, and gain levels as they acquire
 experience, up to a maximum of 30. Monsters have a level that is determined
 by their race, and is typically between 1 and 30, but can exceptionally go
 over 30.

The most direct benefit of Level is its impact on character attacks and 
 defenses - both PCs and monsters get a bonus to their Hit Rolls and defenses
  based on their level, which is explained in the following section.

In addition, a character's Hit Points are derived from character level
 (and class), and attack damage increases with level. For a detailed view of
  damage progression for Player Characters, see Levelling in the Character
  Building chapter. For a detailed view of damage progression for monsters,
  see Monster Stats in the Monster chapter.

Based on the level of Player Characters, the game is organized in three
 **tiers**: **Heroic** (levels 1 to 10), **Paragon** (levels 11 to 20) and
 **Epic** (levels 21 and above). Character tier is sometimes referenced by
 game elements such as feats, but otherwise has no direct impact on the game.
 For a detailed discussion of tiers, see Levelling in the Character Building
 chapter.
 
### Level Bonuses to Hit and Defenses.

PCs and monsters get a bonus to their Hit Rolls and defenses based on their 
level, as shown in the table below:

Level | PC Hit Bonus | PC Def Bonus | Monster Hit Bonus | Monster Def Bonus
-- | -- | -- | -- | --
1 | 0 | 0 | 0 | 0
2 | 0 | 1 | 0 | 1
3 | 1 | 1 | 1 | 1
4 | 1 | 2 | 1 | 2
5 | 2 | 2 | 2 | 2
6 | 2 | 3 | 2 | 3
7 | 3 | 3 | 3 | 3
8 | 3 | 4 | 3 | 4
9 | 4 | 4 | 4 | 4
10 | 4 | 5 | 4 | 5
11 | 5 | 5 | 5 | 5
12 | 5 | 6 | 5 | 6
13 | 6 | 6 | 6 | 6
14 | 6 | 7 | 6 | 7
15 | 7 | 7 | 7 | 7
16 | 7 | 8 | 7 | 8
17 | 8 | 8 | 8 | 8
18 | 8 | 9 | 8 | 9
19 | 9 | 9 | 9 | 9
20 | 9 | 10 | 9 | 10
21 | 10 | 10 | 10 | 10
22 | 10 | 11 | 10 | 11
23 | 11 | 11 | 11 | 11
24 | 11 | 12 | 11 | 12
25 | 12 | 12 | 12 | 12
26 | 12 | 13 | 12 | 13
27 | 13 | 13 | 13 | 13
28 | 13 | 14 | 13 | 14
29 | 14 | 14 | 14 | 14
30 | 15 | 15 | 15 | 15

Note that these bonuses are already included in a monster's stat block - they 
are provided here for reference.

### Hit Points

Combat in the game is represented as a succession of attacks where characters
 deal a certain amount of damage to each other. **Hit Points** 
 (abbreviated as **HP**) are a character stat that determines how much damage
 the character can take before falling unconscious.

The amount of HP of a Character depends on character Level and Class, 
for Player Characters, and on character Level, monster Role, and monster Type, 
in the case of monsters. The HP progression for Player Characters is:

<div class="very-narrow">
```{r, echo=FALSE, results='asis', message=FALSE, warning=FALSE, prompt=FALSE}
get_df_hp_html()
```
</div>

A character under half of their maximum Hit Points is said to be Bloodied.
 Many game effects check for the Bloodied condition in characters. 

#### Surge Value

For Player Characters, another stat related to Hit Points is the
**Surge Value**, which determines the amount of HP that is healed when a
character Heals a Surge. A character's Surge Value is determined as follows:

```
Surge Value = Base Surge Value + Surge Modifier + other Surge bonuses
```

**Base Surge Value** is shown in the table above,
 and is typically roughly equal to one quarter their Hit Points.
 Effects that modify a character's maximum Hit Points do not affect
 their Base Surge Value.

**Surge Modifier** is a bonus to a character's Surge Value
 (the base amount of HP recovered when Healing a Surge) based
 on the Constitution or Charisma score. It is calculated as follows:

```
Surge Modifier = (highest of Con and Cha) * Ability Multiplier
```

<div class="very-narrow">
Level  | Ability Multiplier
------------- | -------------
1   | x1
4	| x1.5
9	| x2
11 	| x2.5
14	| x3
17 	| x3.5
19	| x4
21 	| x5
24	| x6
27 	| x7
29	| x8
</div>


### Abilities

All characters have six Abilities, which are used for non-combat interaction 
such as Skill Checks and Ability Checks, as well as for combat maneuvers. 
For Player Characters, Abilities are often used to determine the effect
 of Powers and other attacks. The abilities are:

- **Strength (Str)**: Ability to exert force, perform physical feats
- **Constitution (Con)**: Ability to endure pain, make long efforts, concentrate.
- **Dexterity (Dex)**: Ability to move quickly and gracefully. Coordination.
- **Wisdom (Wis)**: Ability to know the environment, observe and anticipate.
  Intuition.
- **Charisma (Cha)**: Ability to communicate and persuade. Self-confidence.
- **Intelligence (Int)**: Ability to reason, memorize, learn.

Each Ability is a value, typically ranging between -1 and 5, which is applied
 as a modifier to Skill Checks, Ability Checks, and a variety of Power effects,
 with the exception of those dealing with damage and healing. For effects 
 related to damage and healing of a Player Character, an Ability is adjusted by
 a level-dependent multiplier. This is called an Ability Damage Modifier.

For Player Characters, some stats that are derived from Abilities. 
These are the Secondary Defenses (Fortitude, Reflex, Will) and Secondary Stats
 (Opportunity Modifier, Surge Modifier, and Initiative Modifier). These are the stats that correspond
 to each Ability:

- **Strength**: Fortitude, Opportunity Modifier
- **Constitution**: Fortitude, Surge Modifier
- **Dexterity**: Reflex, Initiative Modifier
- **Wisdom**: Reflex, Opportunity Modifier
- **Charisma**: Will, Surge Modifier
- **Intelligence**: Will, Initiative Modifier

The process for generating a Player Character's Abilities is described in the 
Stat Generation section, in the Character Building chapter.

#### Ability Damage Modifier {#abilitymult}  

As the level of characters increases, so do their Hit Points, the amount of
 damage they deal, and the amount of healing they require. To keep Ability
 modifiers relevant when applied to damaging and healing effects of a Player
 Character, we adjust them by a multiplier that depends on the character's
 level. The Ability modifier multiplied by this value is called
 **Ability Damage Modifier**. There is an Ability Damage Modifier for each
 character Ability, and there are referred to as Strength Damage Modifier,
 Dexterity Damage Modifier, and so on. 

The multiplier applied for an Ability Damage Modifier varies with the
 character's level, from 1 at level 1 to a maximum of 8 at level 30.
 The progression by level is:

<div class="very-narrow">
Level  | Ability Multiplier
------------- | -------------
1   | x1
4	| x1.5
9	| x2
11 	| x2.5
14	| x3
17 	| x3.5
19	| x4
21 	| x5
24	| x6
27 	| x7
29	| x8
</div>

An Ability Damage Modifier is applied instead of a regular
 Ability score in the following cases:

- Damage roll and extra damage
- Extra Miss Damage
- Damage modifier
- Damage penalty
- Shield Points (also known as Temporary Hit Points)
- Bonus to HP
- Surge Bonus
- Healing or extra healing
- Regeneration

<div class="compatibility">**Compatibility Note**: 
Some old powers use Ability Modifiers in combination with Resistances or
 Vulnerabilities. This is no longer supported - to see how this is
 translated to the current rules, see Resistances and Vulnerabilities
 in the Combat chapter.</div>

### Defenses

A character''s defenses determine how hard the character is to hit with attacks.
 Characters have one Primary Defense and three Secondary Defenses.

<div class="tip">**Tip**: Defense values typically range between 11 and 17 for
 Player Characters, and between 11 and 15 for monsters. For all characters,
 the average defense value is 13, which corresponds to a 60% chance of being
 hit on an attack with the typical hit bonus of +4.</div>

**Armor** (**Arm**), is the Primary Defense, the one most commonly targeted
 by attacks. For Player Characters, Arm is determined by the type of Armor
 and Shield worn by the character, plus a class-dependent bonus if the
 character is wearing Light Armor. The following formula is used while
 wearing Light Armor:
```
Arm = 10 + Armor bonus + Shield bonus + Class Light Armor bonus
```
A Player Character wearing Heavy Armor uses the following Arm formula instead:
```
Arm = 10 + Armor bonus + Shield bonus
```

A table stating the Arm bonuses for each type of Armor and Shield is provided
 in the Equipment section of the Character Building chapter. A table with
 the Light Armor bonuses and other class stats is provided in the Class
 section of the Character Building chapter.

For Monsters, Arm is determined by monster class. A table with the typical Arm
 values for each class role is provided in the Monster Stats section of the
 Monsters chapter.

The Secondary Defenses are **Fortitude** (For), **Reflex** (Ref) and **Will**
 (Wil). These defenses are used much less frequently than Armor Class: on
 average, all three Secondary Defenses put together are targeted roughly as
 much as Arm. For Player Characters, each Secondary defense is determined by
 the character's Ability scores, plus a bonus based on character class: 
 
```
For = 10 + Class bonus to For + (highest of Str and Con)
Ref = 10 + Class bonus to Ref + (highest of Dex and Wis)
Wil = 10 + Class bonus to Wil + (highest of Cha and Int)
```

A table stating the Secondary Defense bonuses and other stats for classes
 is provided in the Class section of the Character Building chapter.

For Monsters, Secondary Defenses are determined by monster class. A table
 with the typical defense values for each class role is provided in the
 Monster Stats section of the Monsters chapter.

<div class="tip">**Tip**:As a general guideline, each defense is targeted
 by the following types of attacks:

- Armor: Physical attacks, including most melee attacks, some ranged attacks,
  and a few close and area attacks.
- Fortitude: Physical, Poison, Shadow and Cold attacks, including some
  melee attacks, and a few ranged, close and area attacks.
- Reflex: Physical, Fire, Lightning, Radiant and Cold attacks, including
  most close and area attacks, and a few melee and ranged attacks.
- Will: Physical, Psychic, Radiant and Poison attacks, including some
  ranged attacks, and a few melee, close, and area attacks.
</div>

### Secondary Stats

In addition to their direct application as modifiers to Powers and Skill Checks,
 a Player Character's Ability scores are used to generate six important stats:
 the three Secondary Defenses and three **Secondary Stats**. The Secondary Stats
 are **Opportunity Modifier**, **Surge Modifier**, and **Initiative Modifier**.

#### Opportunity Modifier

**Opportunity Modifier** is a hit modifier that applies to a character's opportunity attacks.
 An Opportunity Attack is a Reaction attack that a character can make when an enemy, moves
 or makes a Ranged or Area attack while adjacent to them.

 ```{r, echo=FALSE, results='asis', message=FALSE, warning=FALSE, prompt=FALSE}
library(sfrpg)
read_df_power() %>% dplyr::filter(type=='maneuver', Name=='Opportunity Attack') %>%
      dplyr::select(-type) %>% clean_df_power()  %>% .$htm_power %>% cat()
```

 Typical values for a Opportunity Modifier range between -5 and +0. For Player Characters,
 a Opportunity Modifier is determined as follows:
 
```
Opportunity Modifier = (highest of Str and Wis) - 4
```


For a detailed discussion Opportunity Attacks, see Reactions in
 the Combat chapter.

#### Surge Modifier

**Surge Modifier** is a bonus to a character's Surge Value
 (the base amount of HP recovered when Healing a Surge) based
 on the Constitution or Charisma score. It is calculated as follows:

```
Surge Modifier = (highest of Con and Cha) * Ability Multiplier
```

<div class="very-narrow">
Level  | Ability Multiplier
------------- | -------------
1   | x1
4	| x1.5
9	| x2
11 	| x2.5
14	| x3
17 	| x3.5
19	| x4
21 	| x5
24	| x6
27 	| x7
29	| x8
</div>

For a detailed description of Surge Values, check the [Hit Points][Surge Value] section earlier in this chapter. For more information about Surge usage and recovery, see Healing in the [Combat] chapter, and [Resting] in the [Adventuring] chapter.

#### Initiative Modifier

**Initiative Modifier** is a value that is added to a character's Initiative
 Roll at the start of an encounter, to determine the order in which character
 turns are taken. Typical values for an Initiative Modifier range between
 -1 and +4. Characters wearing armor may suffer an Armor Penalty, which is
 applied to the Initiative Modifier as well as to many Skills:
 
```
Initiative Modifier = (highest of Dex and Int) - Armor Penalty
```

For a description of Initiative Rolls, see [Rolling Initiative] in the Combat
 chapter, and for a list of the different types of armor and their associated
 Armor Penalty, see [Armor] in the [Character Building] chapter.

#### Secondary Stats in monsters

Monster characters also have a Opportunity Modifier and Initiative Modifier
 though, with no way to heal a surge, they have no Surge Value. These stats are
 determined by monster class; a table with typical stat values for each class
 role is provided in the [Base Stats] section of the [Monsters] chapter.



### Movement Speed

During an encounter, characters are assigned a position in a grid map, and
 they can take actions to move to new positions. The base movement
 distance that a character can move, measured in map squares, is called
 **Movement Speed**. This stat depends on the character's origin, and
 its value typically ranges between 4 and 7. Player Characters wearing
 Heavy Armor usually apply an Armor Movement Penalty of -1 to their Movement
 Speed:
 
```
Movement Speed = Origin Speed - Armor Movement Penalty.
```

A summary table with the origin Speed and other stats corresponding to each
 Player Character origin is provided in the Origins section of the Character
 Building chapter. A table with the properties of different types of Armor
 and Shields, including Armor Movement Penalty, is provided in the Equipment
 section of the Character Building chapter.

Movement Speed is used for characters moving on the ground, which in the
 game world may translate into walking, running, crawling, oozing,
 rolling, or other exotic means of displacement. Some characters are capable
 of other forms of movement, such as flying or swimming, which have their
 own speed stats:

- **Flight Speed**, for creatures capable of flying.
- **Swimming Speed**, for aquatic creatures capable of swimming without
  a Skill check.
- **Burrowing Speed**, for moving by making tunnels in the ground or through
  walls.
- **Teleport Speed**, for creatures capable of teleporting between two squares
  within sight.

Whenever a game element refers to a character's Speed, this applies to the
 Speed for any type of movement the character is using at the moment.

An in-depth discussion of different modes of movement is provided in the
 Movement section of the Combat chapter.


## Powers

Player Characters can gain powers from their Origin, Class, Feats and Magic Items. Monsters can also have powers. In this section, we explain how to read a power.

Consider the following example power:

(TODO: ADD EXAMPLE POWER)

We can see the following elements in the power text block:

- Power type: Utility or Attack
- Power Name
- Power Level: Used in character creation for PCs
- Usage Frequency: At-Will, Encounter, Daily or Recharge.
- Keywords: Descriptive categories, like Weapon, Implement or Fire
- Action Type: Standard, Move, Minor, Free, Reaction or Free Reaction
- Action Trigger: Some powers are only triggered on a specific condition.
- Range: Melee, Ranged, Close or Area
- Attack Roll: Describes bonus to hit, targeted defense.
- Effect on Hit: Describes power effects, including damage, on a successful hit roll.
- Effect on Miss: Describes power effects, including damage, on a failed hit roll.
- Effect: Describes fixed effects that happen regardless of hit roll.
- Sustain: Some powers can persist if the character spends additional actions on subsequent turns.
- Upgrade: Used in character creation for PCs: Additional effects gained when the power occupies a higher level slot.

Each power element is described in detail in the following sections.

### Power Type

Powers can be of 2 types:
- Attack: A power used to hurt an enemy.
- Utility: A power that is not an attack. Utilities can help characters move, heal or defend, among other effects.


### Power Name

Powers have a name that identifies them.

<div class="compatibility">**Compatibility Note**: Power Names should be unique within the context of this game edition. That said, legacy rules include thousands of powers, and some of them may share names with current powers. If you need to disambiguate, use "Power Name (current)" to refer to the power in the current edition, and "Power Name (legacy)" to refer to the one from legacy rules.</div>

### Power Level

Powers often have a level. Characters gain power slots as they level up, and these slots can only be filled with powers of the same level or lower.

Powers without a level are typically granted by class or origin features. It is not possible to take a power without a level on a levelled power slot.

### Usage Frequency

Depending on their usage frequency, powers can be:
- At-Will: Can be used without limit.
- Encounter: Can be used once per encounter. Recharged when the character takes an [Short, Long or Full Rest][Resting].
- Daily: Can be used once per day. Recharged when the character takes a Full Rest.
- Recharge: Once used, the character makes a recharge roll at the end of each turn for that power: Roll 1d6, and if the result exceeds the power's Recharge Value, the power is recharged. Normally only monsters have access to Recharge powers.

A character may have multiple instances of a power. In that case, the usage limit applies separately for each instance of the power. For example, a character with 2 instances of the same encounter power may use that power twice per encounter. Likewise, a power may come with multiple charges: An "Encounter x2" power may be used twice per encounter, and a "Daily x2" power may be used twice per day.

Note: There are some ways other than a Full Rest that a character may recharge a Daily Power - see the [Resting] section for more details.

#### Attack Cooldown

For attack powers with limited usage frequency, an additional restriction applies. When using such a power, the character enters a state of *Attack Cooldown*, and cannot use other powers with the same usage frequency until the cooldown ends:
- Encounter Attack powers: The character enters Encounter Attack Cooldown until the end of their next turn.
- Daily Attack powers: the character enters Daily Attack Cooldown until the end of the encounter.

This means that a character will typically only be able to use an encounter attack every other turn, and a daily attack once per encounter, regardless of how many unspent powers they have.

Some powers have the *No Cooldown* keyword. These powers do not cause the character to enter a cooldown, and a character is not prevented from using them while in a cooldown.

Some powers have the *Reliable* keyword, which prevents the powers from being spent on a missed attack. A power that remains unspent due to Reliable does not cause the character to enter a cooldown.

### Power Keywords

List of keywords with rules:
* Weapon
* Implement
* Conjuration
* Spirit
* Summon
* Control

List of damage type keywords:
* Fire
* Cold
* Lightning
* Radiant
* Shadow
* Poison
* Psychic

#### Conjuration

Powers with the Conjuration keyword create new objects on the battlefield, called *conjurations*. Conjurations occupy space, based on their size, which is Medium unless otherwise stated. They do not count as characters, do not have HP and cannot take actions. They cannot be attacked unless the power description says otherwise - in that case, they have the same defenses as their creator (unless otherwise stated), and the effect of attacking them is explained in the power block.

Conjurations are unaffected by status effects, but may be affected by forced movement.

Some powers allow their users to move a conjuration. Unless otherwise stated, conjuration movement follows the same rules as a character walking: Must stay in ground spaces, are affected by Difficult Terrain or blocking terrain. This is the case even if the conjuration is described as floating. Conjurations do not trigger opportunity attacks. A conjuration may fall, for example if moving over a pit, but does not suffer fall damage and cannot be knocked prone. Unless otherwise stated, the conjuration user needs to have line of sight to the destination space of a conjuration's movement.

#### Spirit

Some powers of the [Shaman class](#shaman) have the **Spirit** keyword. The following rules apply to a power with this keyword.
* A character may only choose to learn the power if they have the **Spirit Companion** power.
* A character may only use the power while they have an active Spirit Companion.
* Range for the power is determined from the Spirit Companion's space.

#### Zone

Powers with the Zone keyword create areas with special properties in the battlefield, called *zones*. The shape of a zone depends on the power that creates it: usually, a Close or Area power will define a zone in its blast or burst. It is also possible to have a zone composed of a single square, or a square and all adjacent spaces.

Depending on the power creating them, zones may last for a turn or a full encounter. Some zones have the Sustain keyword, allowing the creator to extend their duration.

Zones typically cover a fixed area, but some powers allow the zone creator to move a zone.

Some zones have the Zone Damage property. Characters in a zone with Zone Damage take damage when they enter the zone or end their turn in the zone. This damage can only trigger once per turn, for each zone.

#### Summon

Powers with the Summon keyword create creatures that act as allies to the caster in the battlefield, called *Summons*. A Summon is medium-sized unless otherwise stated.  The following rules apply to Summons:
- Summon powers can create a Summon in a non-occupied space within the power's range. If the power is a ranged attack power, the summon can be created at Long Range, but in that case the summon is Hindered until end of turn.
- Can be attacked and damaged like a normal character. When reduced to 0 HP, a Summon is destroyed.
- Unless otherwise stated, a Summon has the same defenses as its caster.
- Last until the end of the encounter unless otherwise stated.
- Summons do not act independently of their caster. During their turn, the caster can spend their own actions to grant the Summon an action of that type. Some Summons can act automatically at the end of their caster's turns. Some Summons can use Reactions, such as Opportunity Attacks, by spending the caster's actions of that type for the turn.
- When a Summon attacks, the caster applies bonuses from feats, class features, equipment and other modifiers as if they were making the attack.

<div class="tip">Normally, only Daily Summon powers last until the end of an encounter. At-Will and Encounter Summon powers usually last one turn or have Sustain Minor.</div>

#### Control

Powers with the Control keyword are stronger than normal attacks, wielded by characters with the Controller role. A character may only take a Control power if they have the Controller Power class feature.

<div class="tip">**Tip**: A character taking the Multiclass feat to multiclass into a Controller class can take a few Control powers.</div>

<div class="tip">**Tip**: A non-Controller character can access Control powers from their same class by taking the Class Specialization feat.</div>

<div class="design">**Designer's Note**: The reasoning behind this description is to allow the design of classes where some builds have the Controller role and others don't. Since Controller attacks are stronger than normal attacks, non-controller powers would become obsolete for some builds, otherwise.</div>

<div class="compatibility">**Compatibility Note**: The Control keyword does not exist in legacy rulebooks. When using legacy options, assume that any attack (but not Utility) power from a Controller build has it. Likewise, assume that any class build with the Controller role has the following class feature:

Controller Power: This character can take attack powers with the Control keyword.
</div>

### Action Type

#### Action Trigger

### Power Range

The following types of power range are supported:

* Melee: target adjacent characters
* Ranged: target characters that are far away
* Close: target characters in an area originating from you
* Area: target characters in an area originating from a point far away

#### Range - Melee

Melee powers can be used against characters adjacent to you. In some scenarios, described below, they can be used to target characters further away.

**Melee Reach** : Most characters have a Melee Reach of 1. Some character abilities or weapons may grant additional Reach. Characters using a melee power can choose targets within a number of squares up to their Reach.

<div class="tip">**Example - Melee Reach**: A typical character with Reach 1 can only use melee powers against adjacent characters. A character with Reach 2 can target characters that are 1 or 2 squares away, and so on.</div>

**Melee powers with a fixed range** : Some melee powers may state their range as `Melee 2`, or a different number. In that case, use that number as the melee reach for the attack.

<div class="tip">**Clarification - Melee Reach vs Ranged Attacks**: Melee attacks with a reach greater than 1 are similar to Ranged attacks, but there are important differences. Characters using ranged powers while enemies are adjacent are often penalized for it. In addition, characters making ranged attacks have the option of extending the attack range to Long Range, while characters making melee attacks don't.</div>


#### Range - Ranged

Ranged powers can be used against characters within a certain distance from you. However,  using ranged powers while enemies are adjacent to you can be dangerous.

**Maximum Range** : The range for a power is usually stated as `Ranged N`, where `N` is the maximum range for the power. For example, a `Ranged 10` power can target characters up to a distance of 10 squares. Some powers have a range of `Ranged Weapon`. In this case, the maximum range depends on the weapon used for the power - for example, a Shortbow has a range of 8 squares.

**Long Range Attacks** : When using a Ranged Attack (but not a Ranged Utility power), you can choose a target that is at a distance between the attack range and double the attack range. This attack is considered a Long Range attack, and suffers a -2 penalty to hit.

 **Armor Range Penalty**: Some types of armor have a Range Penalty value (typically -2).
 This penalty reduces the range of Ranged and Area powers, and is applied before
  doubling the range for Long Range attacks.

**Provoking opportunity attacks** : When a character uses a ranged power while an enemy is adjacent to them, they provoke an Opportunity Attack from that enemy:

```{r, echo=FALSE, results='asis', message=FALSE, warning=FALSE, prompt=FALSE}
library(sfrpg)
read_df_power() %>% dplyr::filter(type=='maneuver', Name=='Opportunity Attack') %>%
      dplyr::select(-type) %>% clean_df_power()  %>% .$htm_power %>% cat()
```

**Safe Ranged powers** : Some Ranged powers have the Safe keyword. Using these powers does not provoke opportunity attacks due to using a Ranged power while adjacent to an enemy. Note that it is still possible that using the power will provoke an opportunity attack for other reasons, such as special abilities from an enemy.

**Avoiding opportunity attacks** : It is possible to avoid opportunity attacks from using a ranged power in melee range with the Point Blank Shot maneuver:

```{r, echo=FALSE, results='asis', message=FALSE, warning=FALSE, prompt=FALSE}
library(sfrpg)
read_df_power() %>% dplyr::filter(type=='maneuver', Name=='Point Blank Shot') %>%
      dplyr::select(-type) %>% clean_df_power()  %>% .$htm_power %>% cat()
```


#### Range - Close

#### Range - Area



### Power Attack Roll

### Effect on Hit

### Effect on Miss

### Power Effect



### Power Upgrades

#### Special power effects

Some powers have special effects, as described below

### Sustain Powers

Sustain: The character creating an effect may extend its duration by spending an action during their next turns:

* Sustain Minor: Spend a Minor Action to extend the effect until the end of the character's next turn.
* Sustain Standard: Spend a Standard Action to extend the effect until the end of the character's next turn.

Once a power's effect ends, it can no longer be Sustained.


Some character abilities may grant a Free Sustain:

* Free Sustain Minor: The character may Sustain a power with Sustain Minor without spending an action.
* Free Sustain: The character may Sustain a power with Sustain Minor or Sustain Standard without spending an action.

### Aftereffect

Some powers have a Aftereffect, which is an effect that takes place after another effect ends.

Example:

* The target is Immobilized until end of your next turn. Aftereffect: The target is Slowed until the end of your next turn.
* In this case, the target will be Immobilized for a turn, then Slowed for another turn.


